<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>アライグマゲーミング ゲーム結果</title>
    <style>
        header {
            height: 10vh;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        h1,h2,h3,p{
            text-align: center;
        }
        footer p{
            text-align: right;
            font-size: 0.8em;
        }
        .jumping-text span {
            display: inline-block;
            animation: jump 7s ease-in-out infinite;
        }
        @keyframes jump {
            0% { transform: translateY(0); }
            2% { transform: translateY(-1.5vh); }
            7% { transform: translateY(0); }
        }
        .jumping-text span:nth-child(1) {animation-delay: 0s;}
        .jumping-text span:nth-child(2) {animation-delay: 0.05s;}
        .jumping-text span:nth-child(3) {animation-delay: 0.10s;}
        .jumping-text span:nth-child(4) {animation-delay: 0.15s;}
        .jumping-text span:nth-child(5) {animation-delay: 0.20s;}
        .jumping-text span:nth-child(6) {animation-delay: 0.25s;}
        .jumping-text span:nth-child(7) {animation-delay: 0.30s;}
        .jumping-text span:nth-child(8) {animation-delay: 0.35s;}
        .jumping-text span:nth-child(9)  {animation-delay: 0.40s;}
        .jumping-text span:nth-child(10) {animation-delay: 0.45s;}
        .jumping-text span:nth-child(11) {animation-delay: 0.50s;}
        .jumping-text span:nth-child(12) {animation-delay: 0.55s;}
        .underlined-text {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <header>
        <h1 class="jumping-text">
            <span>T</span><span>H</span><span>A</span><span>N</span><span>K</span><span> </span>
            <span>Y</span><span>O</span><span>U</span><span> </span>
            <span>F</span><span>O</span><span>R</span><span> </span>
            <span>P</span><span>L</span><span>A</span><span>Y</span><span>I</span><span>N</span><span>G</span>
        </h1>
    </header>
    <main>
        <h2 class="underlined-text">ゲーム結果</h2>
        <p>このページでは、ゲーム結果が表示されます。</p>

        <!-- 画像表示 -->
        <img id="resultImage" src="" alt="ゲーム結果画像" style="max-width: 100%; height: auto; display: none;">

        <!-- テキスト内容表示 -->
        <p id="textResult" style="display: none;"></p>

        <!-- エラーメッセージ -->
        <p id="errorMessage_Nopicture" style="color: red; display: none;">error: no picture</p>
        <p id="errorMessage_Notext" style="color: red; display: none;">error: no text</p>
        <p id="errorMessage_Nokey" style="color: red; display: none;">error: no picture and text</p>

        <script>
            window.onload = function() {
                const params = new URLSearchParams(window.location.search);
                const key = params.get('key'); // URLパラメータ "key" を取得
        
                if (key) {
                    const imageUrl = `https://ren-241121.onrender.com/get_image/${key}?t=${new Date().getTime()}`;
                    const textUrl = `https://ren-241121.onrender.com/get_text/${key}?t=${new Date().getTime()}`;
        
                    // 画像処理
                    const imgElement = document.getElementById('resultImage');
                    imgElement.src = imageUrl;
                    imgElement.onload = function() {
                        imgElement.style.display = "block";
                    };
                    imgElement.onerror = function() {
                        imgElement.style.display = "none";
                        document.getElementById('errorMessage_Nopicture').style.display = "block";
                    };
        
                    // テキスト処理
                    fetch(textUrl)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error("No text or time up");
                            }
                            return response.text();
                        })
                        .then(text => {
                            const textElement = document.getElementById('textResult');
                            textElement.textContent = text;
                            textElement.style.display = "block"; // 表示
                        })
                        .catch(error => {
                            console.error(error);
                            document.getElementById('errorMessage_Notext').style.display = "block";
                        });
        
                } else {
                    // クエリパラメータがない場合のエラー
                    document.getElementById('errorMessage_Nokey').style.display = "block";
                }
            };
        </script>
        
        <p style="color:red">注：このサイトは、ゲーム終了後1時間でアクセス不可となります。</p>
    </main>

    <footer>
        <p>アライグマゲーミング 製作</p>
    </footer>
</body>
</html>

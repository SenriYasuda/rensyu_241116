<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>アライグマゲーミング ゲーム結果</title>
    <style>
        header {
            height: 4vh;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        h1, h2, h3, p {
            text-align: center;
        }
        footer p {
            text-align: right;
            font-size: 0.8em;
        }
        .jumping-text span {
            display: inline-block;
            animation: jump 7s ease-in-out infinite;
        }
        @keyframes jump {
            0% { transform: translateY(0); }
            2% { transform: translateY(-1.5vh); }
            7% { transform: translateY(0); }
        }
        .jumping-text span:nth-child(1) { animation-delay: 0s; }
        .jumping-text span:nth-child(2) { animation-delay: 0.05s; }
        .jumping-text span:nth-child(3) { animation-delay: 0.10s; }
        .jumping-text span:nth-child(4) { animation-delay: 0.15s; }
        .jumping-text span:nth-child(5) { animation-delay: 0.20s; }
        .jumping-text span:nth-child(6) { animation-delay: 0.25s; }
        .jumping-text span:nth-child(7) { animation-delay: 0.30s; }
        .jumping-text span:nth-child(8) { animation-delay: 0.35s; }
        .jumping-text span:nth-child(9) { animation-delay: 0.40s; }
        .jumping-text span:nth-child(10) { animation-delay: 0.45s; }
        .jumping-text span:nth-child(11) { animation-delay: 0.50s; }
        .jumping-text span:nth-child(12) { animation-delay: 0.55s; }
        .jumping-text span:nth-child(13) { animation-delay: 0.60s; }
        .jumping-text span:nth-child(14) { animation-delay: 0.65s; }
        .jumping-text span:nth-child(15) { animation-delay: 0.70s; }
        .jumping-text span:nth-child(16) { animation-delay: 0.75s; }
        .jumping-text span:nth-child(17) { animation-delay: 0.80s; }
        .jumping-text span:nth-child(18) { animation-delay: 0.85s; }
        .jumping-text span:nth-child(19) { animation-delay: 0.90s; }
        .jumping-text span:nth-child(20) { animation-delay: 0.95s; }
        .jumping-text span:nth-child(21) { animation-delay: 1.00s; }
        .underlined-text {
            text-decoration: underline;
        }

        /* 中央揃えのためのスタイル */
        .button-container {
            display: flex; /* フレックスボックスを使用 */
            justify-content: center; /* 水平方向に中央揃え */
            align-items: center; /* 垂直方向に中央揃え */
            height: 6vh; /* 画面全体の高さ */
            margin-top: 5vh; /* ボタンを縦に並べる */
        }

        button {
            margin: 10px; /* ボタン間の余白 */
            padding: 10px 20px; /* ボタンの余白 */
            font-size: 16px; /* ボタンの文字サイズ */
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #lineShareButton {
            background-color: #00c300; /* LINEの緑色 */
            color: white;
        }

        #twitterShareButton {
            background-color: #1DA1F2; /* Twitterの青色 */
            color: white;
        }
    </style>
</head>
<body>
    <header>
        <h1 class="jumping-text">
            <span>T</span><span>H</span><span>A</span><span>N</span><span>K</span><span> </span>
            <span>Y</span><span>O</span><span>U</span><span> </span>
            <span>F</span><span>O</span><span>R</span><span> </span>
            <span>P</span><span>L</span><span>A</span><span>Y</span><span>I</span><span>N</span><span>G</span>
        </h1>
    </header>
    <main>
        <hr> <!--線を引く-->
        <h2 class="underlined-text">＜ゲーム結果＞</h2>

        <!-- 画像表示 -->
        <img id="resultImage" src="" alt="ゲーム結果画像" style="max-width: 100%; height: auto; display: none; margin: 0 auto;">

        <!-- 画像の説明表示 -->
        <p id="imageDescription" style="text-align: center; font-size: 1.2em; margin-top: 10px;"></p>

        <!-- メッセージ表示 -->
        <p id="messageDisplay" style="text-align: center; font-size: 1.2em; margin-top: 20px; color: green;"></p>

        <!-- エラーメッセージ -->
        <p id="errorMessage_Nopicture" style="color: red; display: none;">error: no picture</p>
        <p id="errorMessage_NoKey" style="color: red; display: none;">error: no picture and text</p>
        <p id="resultMessage" style="text-align: center; font-size: 1.5em; margin-top: 20px;"></p>

        <script>
            let key = ""
            let food = ""
            let score = ""
            window.onload = function() {
                const params = new URLSearchParams(window.location.search);
                const key = params.get('key'); // URLパラメータ "key" を取得
                const score = params.get('score'); // URLパラメータ "得点" を取得
                const food = params.get('food'); // URLパラメータ"食べ物"を所得

                if (key && food && score) {
                    // 画像取得URL
                    const imageUrl = `https://ren-241121.onrender.com/get_image/${key}?t=${new Date().getTime()}`;
                    
                    // 画像処理
                    const imgElement = document.getElementById('resultImage');
                    imgElement.src = imageUrl;
                    imgElement.onload = function() {
                        imgElement.style.display = "block";
                    };
                    imgElement.onerror = function() {
                        imgElement.style.display = "none";
                        document.getElementById('errorMessage_Nopicture').style.display = "block";
                    };
            
                    //tetを表示
                    const resultMessage = `あなたは ${food} を作り ${score} 点を取れたよ！`;
                    document.getElementById('resultMessage').textContent = resultMessage;

                } else {
                    // クエリパラメータがない場合のエラー
                    document.getElementById('errorMessage_NoKey').style.display = "block";
                }
            };
        </script>


        <div class="button-container">
            <button id="lineShareButton">LINEで共有</button>
            <button id="twitterShareButton">Twitterで共有</button>
        </div>
        
        
        <script>
            document.getElementById('lineShareButton').addEventListener('click', function() {
                // パラメータの設定

                const gameUrl = "http://example.com"; // 実際のゲームURL
        
                // メッセージを生成
                const message = encodeURIComponent(
                    `〇〇〇に行って、アライグマゲーミングのEGGを遊んだよ！\n` +
                    `私は ${food} で ${score} 点取れた！\n` +
                    `次のurlで遊ぶことが出来るよ\n${gameUrl}`
                );
        
                // LINE URL Schemeを利用して共有
                const lineShareUrl = `https://line.me/R/msg/text/?${message}`;
        
                // 新しいタブでLINE共有を開く
                window.open(lineShareUrl, '_blank');
            });
        </script>

        <script>
            document.getElementById('twitterShareButton').addEventListener('click', function() {
                // パラメータの設定
                const params = new URLSearchParams(window.location.search);
                const key = params.get('key'); // URLパラメータ "key" を取得
                const score = params.get('score'); // URLパラメータ "得点" を取得
                const food = params.get('food'); // URLパラメータ"食べ物"を所得
                const gameUrl = "http://example.com"; // 実際のゲームURL

                // メッセージを生成
                const message = encodeURIComponent(
                    `#アライグマゲーミング\n\n` +
                    `〇〇〇に行って、アライグマゲーミングのEGGを遊んだよ！\n` +
                    `私は${food}で${score}点取れた！\n` +
                    `次のurlで遊ぶことが出来るよ\n${gameUrl}`
                );

                // Twitter Web Intentを利用して共有
                const twitterShareUrl = `https://twitter.com/intent/tweet?text=${message}`;
                //const twitterShareUrl = `https://twitter.com/intent/tweet?text="a"`;

                // 新しいタブでTwitter共有を開く
                window.open(twitterShareUrl, '_blank');
            });
        </script>
        
        <p style="color:red">注：この画像は、ゲーム終了後1時間でサイトから消えます。</p>
    </main>

    <footer>
        <p>製作：アライグマゲーミング</p>
    </footer>
</body>
</html>

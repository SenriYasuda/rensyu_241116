<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>アライグマゲーミング ゲーム結果</title>
    <style>
        header {
            height: 10vh;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        h1, h2, h3, p {
            text-align: center;
        }
        footer p {
            text-align: right;
            font-size: 0.8em;
        }
        .underlined-text {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <header>
        <h1>ゲーム結果</h1>
    </header>
    <main>
        <h2 class="underlined-text">ゲーム結果</h2>
        <p>このページでは、ゲーム結果が表示されます。</p>

        <!-- 画像表示 -->
        <img id="resultImage" src="" alt="ゲーム結果画像" style="max-width: 100%; height: auto; display: none; margin: 0 auto;">

        <!-- 画像の説明表示 -->
        <p id="imageDescription" style="text-align: center; font-size: 1.2em; margin-top: 10px;"></p>

        <!-- エラーメッセージ -->
        <p id="errorMessage_Nopicture" style="color: red; display: none;">エラー: 画像が見つかりません</p>
        <p id="errorMessage_Nokey" style="color: red; display: none;">エラー: クエリパラメータ "key" がありません</p>

        <script>
            window.onload = function() {
                const params = new URLSearchParams(window.location.search);
                const key = params.get('key'); // URLパラメータ "key" を取得

                if (key) {
                    // 画像のURLを生成
                    const imageUrl = `https://ren-241121.onrender.com/get_image/pic${key}.jpg`;

                    // 画像を表示
                    const imgElement = document.getElementById('resultImage');
                    imgElement.src = imageUrl;
                    imgElement.onload = function() {
                        imgElement.style.display = "block";
                    };
                    imgElement.onerror = function() {
                        imgElement.style.display = "none";
                        document.getElementById('errorMessage_Nopicture').style.display = "block";
                    };

                    // メッセージ部分を抽出
                    const fileName = `pic${key}例です.jpg`; // サーバー上のファイル名
                    const extractedMessage = fileName.match(/^pic\d+(.+?)\.jpg$/)?.[1] || '不明なメッセージ';
                    document.getElementById('imageDescription').textContent = `メッセージ: ${extractedMessage}`;

                } else {
                    // クエリパラメータ "key" がない場合
                    document.getElementById('errorMessage_Nokey').style.display = "block";
                }
            };
        </script>

        <p style="color:red">注：この画像は、ゲーム終了後1時間でサイトから消えます。</p>
    </main>

    <footer>
        <p>アライグマゲーミング 製作あ</p>
    </footer>
</body>
</html>